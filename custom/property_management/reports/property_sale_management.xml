<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Property Sale Report Template -->
    <template id="property_sale_report_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <style>
                            .report-header {
                                text-align: center;
                                margin-bottom: 30px;
                                padding-bottom: 20px;
                                border-bottom: 3px solid #2c3e50;
                            }
                            .report-title {
                                font-size: 28px;
                                font-weight: bold;
                                color: #2c3e50;
                            }
                            .info-section {
                                margin: 20px 0;
                            }
                            .info-label {
                                font-weight: bold;
                                color: #2c3e50;
                                display: inline-block;
                                width: 180px;
                            }
                            .info-value {
                                color: #34495e;
                            }
                            .status-paid {
                                color: green;
                                font-weight: bold;
                            }
                            .status-unpaid {
                                color: red;
                                font-weight: bold;
                            }
                            .status-invoiced {
                                color: sienna;
                                font-weight: bold;
                            }
                        </style>
                        
                        <div class="report-header">
                            <h3 class="report-title">Property Sale Report</h3>
                        </div>
                        
                        <div class="info-section">
                            <div>
                                <span class="info-label">Sale Reference:</span>
                                <span class="info-value" t-field="o.name"/>
                            </div>
                            <div>
                                <span class="info-label">Sale Date:</span>
                                <span class="info-value" t-field="o.sale_date"/>
                            </div>
                            <div>
                                <span class="info-label">Start Date:</span>
                                <span class="info-value" t-field="o.start_date"/>
                            </div>
                            <div>
                                <span class="info-label">Customer Name:</span>
                                <span class="info-value" t-field="o.partner_id.name"/>
                            </div>
                            <div t-if="o.partner_id.street or o.partner_id.city">
                                <span class="info-label">Customer Address:</span>
                                <span class="info-value">
                                    <t t-if="o.partner_id.street"><t t-esc="o.partner_id.street"/>, </t>
                                    <t t-if="o.partner_id.city"><t t-esc="o.partner_id.city"/></t>
                                    <t t-if="o.partner_id.country_id">, <t t-esc="o.partner_id.country_id.name"/></t>
                                </span>
                            </div>
                            <div t-if="o.partner_id.phone or o.partner_id.mobile">
                                <span class="info-label">Customer Contact:</span>
                                <span class="info-value">
                                    <t t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>
                                    <t t-if="o.partner_id.mobile and o.partner_id.phone"> / </t>
                                    <t t-if="o.partner_id.mobile" t-field="o.partner_id.mobile"/>
                                </span>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 30px; color: #2c3e50;">Property Information</h4>
                        <table class="table table-sm table-bordered">
                            <thead style="background-color: #34495e; color: white;">
                                <tr>
                                    <th>Property Name</th>
                                    <th>Property Value</th>
                                    <th>Down Payment</th>
                                    <th>Remaining Balance</th>
                                    <th>DLD Fee</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td align="center"><span t-field="o.property_id.name"/></td>
                                    <td align="center">
                                        <t t-esc="o.currency_id.symbol"/>
                                        <t t-esc="'{:,.2f}'.format(o.property_value)"/>
                                    </td>
                                    <td align="center">
                                        <t t-esc="o.currency_id.symbol"/>
                                        <t t-esc="'{:,.2f}'.format(o.down_payment)"/>
                                    </td>
                                    <td align="center">
                                        <t t-esc="o.currency_id.symbol"/>
                                        <t t-esc="'{:,.2f}'.format(o.remaining_balance)"/>
                                    </td>
                                    <td align="center">
                                        <t t-esc="o.currency_id.symbol"/>
                                        <t t-esc="'{:,.2f}'.format(o.dld_fee)"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h4 style="margin-top: 30px; color: #2c3e50;">Installment Payment Schedule</h4>
                        <table class="table table-sm table-bordered">
                            <thead style="background-color: #34495e; color: white;">
                                <tr>
                                    <th style="width: 10%;">SI.No</th>
                                    <th style="width: 30%;">Payment Type</th>
                                    <th style="width: 20%;">Date</th>
                                    <th style="width: 25%;">Amount</th>
                                    <th style="width: 15%;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="o.property_sale_line_ids.sorted(key=lambda x: x.serial_number)" t-as="line">
                                    <tr>
                                        <td align="center"><t t-esc="line.serial_number"/></td>
                                        <td>
                                            <t t-if="line.line_type == 'downpayment'">Down Payment</t>
                                            <t t-if="line.line_type == 'dld_fee'">DLD Fee</t>
                                            <t t-if="line.line_type == 'admin_fee'">Admin Fee</t>
                                            <t t-if="line.line_type == 'emi'">Installment <t t-esc="line.serial_number - 3"/></t>
                                        </td>
                                        <td align="center">
                                            <t t-esc="line.collection_date.strftime('%d %b %Y')"/>
                                        </td>
                                        <td align="right">
                                            <t t-esc="o.currency_id.symbol"/>
                                            <t t-esc="'{:,.2f}'.format(line.capital_repayment)"/>
                                        </td>
                                        <td align="center">
                                            <span t-if="line.collection_status == 'paid'" class="status-paid">Paid</span>
                                            <span t-if="line.collection_status == 'unpaid'" class="status-unpaid">Unpaid</span>
                                            <span t-if="line.collection_status == 'invoiced'" class="status-invoiced">Invoiced</span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="background-color: #ecf0f1; font-weight: bold;">
                                    <td colspan="3" align="right">Total:</td>
                                    <td align="right">
                                        <t t-esc="o.currency_id.symbol"/>
                                        <t t-esc="'{:,.2f}'.format(sum(o.property_sale_line_ids.mapped('capital_repayment')))"/>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                        
                        <div style="margin-top: 40px; text-align: center; color: #7f8c8d; font-size: 12px;">
                            <p>Generated on <t t-esc="datetime.datetime.now().strftime('%d %B %Y at %H:%M')"/></p>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>